# 小程序性能优化

小程序启动时=>微信=>下载小程序代码包=>加载小程序代码包=>初始化首页

初始化小程序环境是微信环境的工作,我们只需要控制代码包的大小,

最终的渲染载体依然是浏览器内核，并不是原生客户端

对于传统网页

## 一、启动加载时优化

相关的缓存策略控制、资源控制、逻辑控制分包加载控制 来进行启动加载优化

1. 勾选开发者工具中，上传时压缩代码
2. 精简代码，删除不必要的wxml结构和wxss定义
3. 减少在代码中直接嵌入资源文件（比如全国地区库，微信有自带的，在没必要的时候，无用外库）
4. 及时清理无用的资源（js文件、图片、dome页面的等）
5. 压缩图片、使用适当的图片格式，减少吧本地图片的数量等？****
6. 对于复杂的小程序，代码量很大=》使用分包加载
   1. 先加载首页。其他的按需加载
7. 提前做异步请求（onload），我先请求，管你页面渲染好没有（和生活一样）
8. 启动缓存数据策略，请求时先展示缓存的内容，让页面尽快展示，请求到最新的数据之后再刷新
9. 避免白屏，使用骨架屏等，可以做个为空的判断处理

## 二、数据通信优化

1. setData的使用规范

   * 多次setData合并成一次调用

   * 数据通信的性能与数据量正相关=>不在界面中展示的数据且数据结构较为复杂的就不要写进来

     ```javascript
         // 不要设置不在界面渲染时使用的数据，并将界面无关的数据放在data外
         this.setData({
           myData: {
             a: '这个字符串在WXML中用到了',
             b: '这个字符串未在WXML中用到，而且它很长…………………………'
           }
         })
         // 可以优化为
         this.setData({
           'myData.a': '这个字符串在WXML中用到了'
         })
         this._myData = {
           b: '这个字符串未在WXML中用到，而且它很长…………………………'
         }
       }
     })
     ```

## 三、事件通信优化

视图层会接收很多事件：点击事件、触摸事件等，当事件被触发且相关监听器需要被触发时，视图层会将信息反馈给逻辑层，这个反馈是异步的会产生延迟，降低延迟的方法有两个

1. 去掉不必要的事件绑定（wxml中的bindtap和catch）算法优化
2. 事件回调函数中需要传入targer和currentTarget的dataset，所以不要在自定义传输数据data-xx中放置大量的数据

## 四、渲染优化

抛出一个思想

1. 页面方法onPageScroll，每次页面滚动时都会触发，像这种敏感触发机制的就不宜在里面处理大量逻辑

   特别是页面 重绘

2. 视图重绘和vue一样,需要新旧数对比，可以去掉没太大必要的setdata数据